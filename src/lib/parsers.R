parse_hh <- function(fname,yr){
  hh_widths <- fwf_widths(c(4,3,2,2,
                            1,2,2,3,
                            2,2,1,4,
                            5,1,1,2,
                            2,1,1,1,
                            2,1,1,1,
                            8,2,8,4,
                            3,3,10,1),
                          c("file_id",
                            "schedule",
                            "quarter",
                            "visit",
                            "sector",
                            "state_ut",
                            "district",
                            "nss_region",
                            "stratum",
                            "sub_stratum",
                            "sub_sample",
                            "fod_sub_region",
                            "fsu",
                            "sg_sb_no",
                            "stage2_stratum_no",
                            "hh_no",
                            "month",
                            "resp_code",
                            "survey_code",
                            "subst_reason",
                            "hh_size",
                            "hh_type",
                            "religion",
                            "social_group",
                            "cons_exp",
                            "informant_sno",
                            "survey_date",
                            "time_to_canvass",
                            "ns_count_4s",
                            "ns_count_3s",
                            "ss_multiplier",
                            "occurance_4s"))
  
  hh_types <- cols(.default=col_character(),
                   hh_size=col_integer(),
                   ss_multiplier=col_double())
  read_fwf(fname,
           hh_widths,
           col_types=hh_types,
           na="-")%>%
    mutate(year=yr,
           adj_multiplier = if_else(ns_count_4s==ns_count_3s,
                                    ss_multiplier,
                                    ss_multiplier/2),
           uhid=paste(fsu,sg_sb_no,stage2_stratum_no,hh_no,sep="|"))
}


parse_pfv <- function(fname,yr){
  pfv_widths <- fwf_widths(
    c(4,3,2,2,1,2,2,3,2,2,
      1,4,5,1,1,2,2,1,1,3,
      1,2,2,2,2,1,1,2,1,1,
      1,2,5,3,1,2,2,1,1,1,
      1,2,5,3,2,2,1,1,1,1,
      2,2,2,5,2,2,2,5,2,2,
      2,2,2,5,2,2,2,5,2,2,
      2,2,2,5,2,2,2,5,2,2,
      2,2,2,5,2,2,2,5,2,2,
      2,2,2,5,2,2,2,5,2,2,
      2,2,2,5,2,2,2,5,2,2,
      2,2,2,5,2,2,2,5,2,2,
      2,2,3,8,8,3,3,10,1),
    c("file_id",
      "schedule",
      "quarter",
      "visit",
      "sector",
      "state_ut",
      "district",
      "nss_region",
      "stratum",
      "sub_stratum",
      "sub_sample",
      "fod_sub_region",
      "fsu",
      "sg_sb_no",
      "stage2_stratum_no",
      "hh_no",
      "person_no",
      "rel_to_head",
      "sex",
      "age",
      "marital_status",
      "gen_edu_level",
      "tech_edu_level",
      "years_formal_edu",
      "status_cur_attend",
      "if_voc_train",
      "if_train_last_365",
      "field_train",
      "dur_train",
      "type_train",
      "source_fund_train",
      "principal_status_code",
      "principal_industry_code",
      "principal_occupation_code",
      "if_subsidiary_work",
      "principal_loc_work",
      "principal_etype_code",
      "principal_no_workers",
      "principal_contract_type",
      "principal_eligible_leave",
      "principal_social_sec_benefits",
      "subsi_status_code",
      "subsi_industry_code",
      "subsi_occupation_code",
      "subsi_loc_work",
      "subsi_etype_code",
      "subsi_no_workers",
      "subsi_contract_type",
      "subsi_eligible_leave",
      "subsi_social_sec_benefits",
      "status.a1.d7",
      "ind_code.a1.d7",
      "hours.a1.d7",
      "wage.a1.d7",
      "status.a2.d7",
      "ind_code.a2.d7",
      "hours.a2.d7",
      "wage.a2.d7",
      "tot_hours.d7",
      "additional_hours.d7",
      "status.a1.d6",
      "ind_code.a1.d6",
      "hours.a1.d6",
      "wage.a1.d6",
      "status.a2.d6",
      "ind_code.a2.d6",
      "hours.a2.d6",
      "wage.a2.d6",
      "tot_hours.d6",
      "additional_hours.d6",
      "status.a1.d5",
      "ind_code.a1.d5",
      "hours.a1.d5",
      "wage.a1.d5",
      "status.a2.d5",
      "ind_code.a2.d5",
      "hours.a2.d5",
      "wage.a2.d5",
      "tot_hours.d5",
      "additional_hours.d5",
      "status.a1.d4",
      "ind_code.a1.d4",
      "hours.a1.d4",
      "wage.a1.d4",
      "status.a2.d4",
      "ind_code.a2.d4",
      "hours.a2.d4",
      "wage.a2.d4",
      "tot_hours.d4",
      "additional_hours.d4",
      "status.a1.d3",
      "ind_code.a1.d3",
      "hours.a1.d3",
      "wage.a1.d3",
      "status.a2.d3",
      "ind_code.a2.d3",
      "hours.a2.d3",
      "wage.a2.d3",
      "tot_hours.d3",
      "additional_hours.d3",
      "status.a1.d2",
      "ind_code.a1.d2",
      "hours.a1.d2",
      "wage.a1.d2",
      "status.a2.d2",
      "ind_code.a2.d2",
      "hours.a2.d2",
      "wage.a2.d2",
      "tot_hours.d2",
      "additional_hours.d2",
      "status.a1.d1",
      "ind_code.a1.d1",
      "hours.a1.d1",
      "wage.a1.d1",
      "status.a2.d1",
      "ind_code.a2.d1",
      "hours.a2.d1",
      "wage.a2.d1",
      "tot_hours.d1",
      "additional_hours.d1",
      "status.cws",
      "ind_code.cws",
      "occupation_code.cws",
      "earnings_salaried",
      "earnings_self_emp",
      "ns_count_4s",
      "ns_count_3s",
      "ss_multiplier",
      "occurance_4s"))
  pfv_types <- cols(.default=col_character(),
                    age=col_integer(),
                    ss_multiplier=col_double())
  read_fwf(fname,
           pfv_widths,
           col_types=pfv_types,
           na="-")%>%
    mutate( year=yr,
            adj_multiplier = if_else(ns_count_4s==ns_count_3s,
                                     ss_multiplier,
                                     ss_multiplier/2),
            uhid=paste(fsu,sg_sb_no,stage2_stratum_no,hh_no,sep="|"),
            upid=paste(uhid,person_no,sep="|"))
}


parse_prv <- function(fname,yr){
  prv_widths <- fwf_widths(
    c(4,3,2,2,1,2,2,3,2,2,
      1,4,5,1,1,2,2,1,1,3,
      1,2,2,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,2,5,2,
      2,2,5,2,2,2,2,3,8,8,
      3,3,10,1),
    c("file_id",
      "schedule",
      "quarter",
      "visit",
      "sector",
      "state_ut",
      "district",
      "nss_region",
      "stratum",
      "sub_stratum",
      "sub_sample",
      "fod_sub_region",
      "fsu",
      "sg_sb_no",
      "stage2_stratum_no",
      "hh_no",
      "person_no",
      "rel_to_head",
      "sex",
      "age",
      "marital_status",
      "gen_edu_level",
      "tech_edu_level",
      "years_formal_edu",
      "status_cur_attend",
      "status.a1.d7",
      "ind_code.a1.d7",
      "hours.a1.d7",
      "wage.a1.d7",
      "status.a2.d7",
      "ind_code.a2.d7",
      "hours.a2.d7",
      "wage.a2.d7",
      "tot_hours.d7",
      "additional_hours.d7",
      "status.a1.d6",
      "ind_code.a1.d6",
      "hours.a1.d6",
      "wage.a1.d6",
      "status.a2.d6",
      "ind_code.a2.d6",
      "hours.a2.d6",
      "wage.a2.d6",
      "tot_hours.d6",
      "additional_hours.d6",
      "status.a1.d5",
      "ind_code.a1.d5",
      "hours.a1.d5",
      "wage.a1.d5",
      "status.a2.d5",
      "ind_code.a2.d5",
      "hours.a2.d5",
      "wage.a2.d5",
      "tot_hours.d5",
      "additional_hours.d5",
      "status.a1.d4",
      "ind_code.a1.d4",
      "hours.a1.d4",
      "wage.a1.d4",
      "status.a2.d4",
      "ind_code.a2.d4",
      "hours.a2.d4",
      "wage.a2.d4",
      "tot_hours.d4",
      "additional_hours.d4",
      "status.a1.d3",
      "ind_code.a1.d3",
      "hours.a1.d3",
      "wage.a1.d3",
      "status.a2.d3",
      "ind_code.a2.d3",
      "hours.a2.d3",
      "wage.a2.d3",
      "tot_hours.d3",
      "additional_hours.d3",
      "status.a1.d2",
      "ind_code.a1.d2",
      "hours.a1.d2",
      "wage.a1.d2",
      "status.a2.d2",
      "ind_code.a2.d2",
      "hours.a2.d2",
      "wage.a2.d2",
      "tot_hours.d2",
      "additional_hours.d2",
      "status.a1.d1",
      "ind_code.a1.d1",
      "hours.a1.d1",
      "wage.a1.d1",
      "status.a2.d1",
      "ind_code.a2.d1",
      "hours.a2.d1",
      "wage.a2.d1",
      "tot_hours.d1",
      "additional_hours.d1",
      "status.cws",
      "ind_code.cws",
      "occupation_code.cws",
      "earnings_salaried",
      "earnings_self_emp",
      "ns_count_4s",
      "ns_count_3s",
      "ss_multiplier",
      "occurance_4s"))
  prv_types <- cols(.default=col_character(),
                    age=col_integer(),
                    ss_multiplier=col_double())
  read_fwf(fname,
           prv_widths,
           col_types=prv_types,
           na="-")%>%
    mutate( year=yr,
            adj_multiplier = if_else(ns_count_4s==ns_count_3s,
                                     ss_multiplier,
                                     ss_multiplier/2),
            uhid=paste(fsu,sg_sb_no,stage2_stratum_no,hh_no,sep="|"),
            upid=paste(uhid,person_no,sep="|"))
}
